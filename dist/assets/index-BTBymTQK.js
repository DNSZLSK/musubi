(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const Ce="modulepreload",Le=function(e){return"/musubi/"+e},ne={},K=function(t,n,c){let r=Promise.resolve();if(n&&n.length>0){let m=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};var a=m;document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");r=m(n.map(d=>{if(d=Le(d),d in ne)return;ne[d]=!0;const u=d.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":Ce,u||(f.as="script"),f.crossOrigin="",f.href=d,l&&f.setAttribute("nonce",l),document.head.appendChild(f),u)return new Promise((y,k)=>{f.addEventListener("load",y),f.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return r.then(s=>{for(const l of s||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},oe={A:["01110","10001","10001","11111","10001","10001","10001"],B:["11110","10001","10001","11110","10001","10001","11110"],C:["01110","10001","10000","10000","10000","10001","01110"],D:["11110","10001","10001","10001","10001","10001","11110"],E:["11111","10000","10000","11110","10000","10000","11111"],F:["11111","10000","10000","11110","10000","10000","10000"],G:["01110","10001","10000","10111","10001","10001","01110"],H:["10001","10001","10001","11111","10001","10001","10001"],I:["11111","00100","00100","00100","00100","00100","11111"],J:["00111","00010","00010","00010","00010","10010","01100"],K:["10001","10010","10100","11000","10100","10010","10001"],L:["10000","10000","10000","10000","10000","10000","11111"],M:["10001","11011","10101","10101","10001","10001","10001"],N:["10001","10001","11001","10101","10011","10001","10001"],O:["01110","10001","10001","10001","10001","10001","01110"],P:["11110","10001","10001","11110","10000","10000","10000"],Q:["01110","10001","10001","10001","10101","10010","01101"],R:["11110","10001","10001","11110","10100","10010","10001"],S:["01111","10000","10000","01110","00001","00001","11110"],T:["11111","00100","00100","00100","00100","00100","00100"],U:["10001","10001","10001","10001","10001","10001","01110"],V:["10001","10001","10001","10001","10001","01010","00100"],W:["10001","10001","10001","10101","10101","10101","01010"],X:["10001","10001","01010","00100","01010","10001","10001"],Y:["10001","10001","01010","00100","00100","00100","00100"],Z:["11111","00001","00010","00100","01000","10000","11111"],0:["01110","10001","10011","10101","11001","10001","01110"],1:["00100","01100","00100","00100","00100","00100","01110"],2:["01110","10001","00001","00010","00100","01000","11111"],3:["11111","00010","00100","00010","00001","10001","01110"],4:["00010","00110","01010","10010","11111","00010","00010"],5:["11111","10000","11110","00001","00001","10001","01110"],6:["00110","01000","10000","11110","10001","10001","01110"],7:["11111","00001","00010","00100","01000","01000","01000"],8:["01110","10001","10001","01110","10001","10001","01110"],9:["01110","10001","10001","01111","00001","00010","01100"]," ":["00000","00000","00000","00000","00000","00000","00000"],":":["00000","00100","00100","00000","00100","00100","00000"],"-":["00000","00000","00000","11111","00000","00000","00000"],".":["00000","00000","00000","00000","00000","01100","01100"],"<":["00010","00100","01000","10000","01000","00100","00010"],">":["01000","00100","00010","00001","00010","00100","01000"],_:["00000","00000","00000","00000","00000","00000","11111"]},ce=["","theme-cyan","theme-amber","theme-white","theme-pink"],F={startTime:60,bonus:{4:10,5:15,6:20}},Re={4:{name:"Training",grid:"4X4"},5:{name:"Challenge",grid:"5X5"},6:{name:"Expert",grid:"6X6"}},se="https://script.google.com/macros/s/AKfycbzwwGm8kGbcjixpMpR3xhfH4gofyMPY1kXnPdcGzl4tnrJz7ewgVDH2J825Lhh93940/exec",I={musicTracks:["/musubi/Music/Music1.mp3","/musubi/Music/Music2.mp3","/musubi/Music/Music3.mp3","/musubi/Music/Music4.mp3","/musubi/Music/Music5.mp3"],beepSound:"/musubi/Music/beepMenuChoice.mp3",defaultVolume:.5,beepVolume:.3},o={starsEnabled:!0,musicMuted:!1,currentTheme:0,gridSize:4,currentScore:0,puzzlesSolved:0,circles:[],numbers:[],animations:[],chronoEnabled:!1,chronoRemaining:F.startTime,chronoInterval:null,chronoActive:!1,nickname:localStorage.getItem("musubi_nickname")||"PLAYER",nicknameInput:"",nicknameActive:!1,currentLeaderboardMode:0,currentLeaderboardChrono:0,leaderboardData:{training:[],challenge:[],expert:[],training_chrono:[],challenge_chrono:[],expert_chrono:[]},currentTrack:0,musicStarted:!1,audioContext:null,beepBuffer:null};function H(){o.currentScore=0,o.puzzlesSolved=0,o.circles=[],o.numbers=[],o.animations=[]}function j(){o.chronoRemaining=F.startTime,o.chronoActive=!1,o.chronoInterval&&(clearInterval(o.chronoInterval),o.chronoInterval=null)}function Se(e){o.nickname=e||"PLAYER",localStorage.setItem("musubi_nickname",o.nickname)}function w(){return getComputedStyle(document.body).getPropertyValue("--color").trim()||"#5c5"}function xe(){return getComputedStyle(document.body).getPropertyValue("--color-bright").trim()||"#7f7"}function le(e){const t=/^#?([a-f\d]{1,2})([a-f\d]{1,2})([a-f\d]{1,2})$/i.exec(e);return t?{r:parseInt(t[1].length===1?t[1]+t[1]:t[1],16),g:parseInt(t[2].length===1?t[2]+t[2]:t[2],16),b:parseInt(t[3].length===1?t[3]+t[3]:t[3],16)}:{r:92,g:204,b:92}}function Z(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function Be(e){const t=Math.floor(e/60),n=e%60;return`${t}:${n<10?"0":""}${n}`}function C(e,t,n,c,r,i){const a=t.toUpperCase().split("");let s=0;return e.fillStyle=i,a.forEach(l=>{(oe[l]||oe[" "]).forEach((d,u)=>{for(let h=0;h<d.length;h++)if(d[h]==="1")for(let f=0;f<r;f++)f%2===0&&e.fillRect(n+s+h*r,c+u*r+f,r,1)}),s+=6*r}),s}function R(e,t){return e.length*6*t}function g(e,t,n,c,r,i){const a=R(t,r),s=(n-a)/2;C(e,t,s,c,r,i)}function re(e,t,n,c,r,i){e.fillStyle=i;for(let a=0;a<r;a++)a%2===0&&e.fillRect(t,n+a,c,1)}function de(){const e=w();[{id:"menu-newgame",text:"NEW GAME"},{id:"menu-leaderboard",text:"LEADERBOARD"},{id:"menu-nickname",text:"YOUR NICKNAME"},{id:"menu-howto",text:"HOW TO PLAY"},{id:"menu-color",text:"COLOR"}].forEach(n=>{const c=document.getElementById(n.id);if(!c)return;const r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),g(r,n.text,c.width,12,3,e)})}function Me(){const e=w(),t=document.getElementById("diff-title");if(t){const c=t.getContext("2d");c.clearRect(0,0,t.width,t.height),g(c,"SELECT MODE",t.width,10,4,e)}[{id:"diff-training",text:"TRAINING  4X4"},{id:"diff-challenge",text:"CHALLENGE  5X5"},{id:"diff-expert",text:"EXPERT  6X6"},{id:"diff-back",text:"BACK"}].forEach(c=>{const r=document.getElementById(c.id);if(!r)return;const i=r.getContext("2d");i.clearRect(0,0,r.width,r.height),g(i,c.text,r.width,12,3,e)}),J("chrono-toggle",o.chronoEnabled)}function J(e,t){const n=document.getElementById(e);if(!n)return;const c=n.getContext("2d"),r=w();c.clearRect(0,0,n.width,n.height);const i=3,a=R("OFF",i),s=R("ON",i),l=4,m=7*i,d=R("CHRONO",i),u=18,h=d+u+a+l*2+u+s+l*2,f=(n.width-h)/2,y=12;C(c,"CHRONO",f,y,i,r);const k=f+d+u,S=k+a+l*2+u;t?(C(c,"OFF",k,y,i,r),re(c,S-l,y-l,s+l*2,m+l*2,r),C(c,"ON",S,y,i,"#000")):(re(c,k-l,y-l,a+l*2,m+l*2,r),C(c,"OFF",k,y,i,"#000"),C(c,"ON",S,y,i,r))}function P(e,t,n=!0){const c=document.getElementById(e);if(!c)return;const r=c.getContext("2d"),i=n?w():"#333",a=c.width,s=c.height;switch(r.clearRect(0,0,a,s),r.fillStyle=i,t){case"stars":Ae(r);break;case"music":Te(r);break;case"home":Oe(r);break}Pe(r,a,s)}function Ae(e){e.fillRect(23,5,4,4),e.fillRect(19,9,12,4),e.fillRect(11,13,28,4),e.fillRect(15,17,20,4),e.fillRect(19,21,12,4),e.fillRect(15,25,8,4),e.fillRect(27,25,8,4),e.fillRect(11,29,8,4),e.fillRect(31,29,8,4)}function Te(e){e.fillRect(28,6,4,24),e.fillRect(32,6,10,3),e.fillRect(32,11,8,3),e.fillRect(14,24,18,12)}function Oe(e){e.fillRect(23,5,4,6),e.fillRect(15,11,20,4),e.fillRect(11,15,28,4),e.fillRect(14,19,22,16),e.fillStyle="#000",e.fillRect(21,25,8,10)}function Pe(e,t,n){const c=e.getImageData(0,0,t,n);for(let r=0;r<n;r++)if(r%2===1)for(let i=0;i<t;i++){const a=(r*t+i)*4;c.data[a+3]=Math.floor(c.data[a+3]*.3)}e.putImageData(c,0,0)}function Ne(e,t){P("icon-stars","stars",e),P("icon-music","music",!t),P("icon-home","home",!0)}function W(){const e=document.getElementById("puzzle-canvas");if(!e)return;const t=e.getContext("2d"),n=w(),c=xe(),r=o.gridSize,i=Math.min(500,window.innerWidth-40,window.innerHeight-250),a=Math.max(280,i);e.width=a,e.height=a;const s=a/r,l=s*.22,m=Math.max(4,Math.floor(a/100));t.clearRect(0,0,a,a),_e(t,r,s,l,m,n),ze(t,r,s,c),De(t,r,s,l,n)}function _e(e,t,n,c,r,i){e.fillStyle=i;for(let a=0;a<t;a++)for(let s=0;s<t;s++){const l=s*n+n/2,m=a*n+n/2;if(s<t-1){const d=(s+1)*n+n/2;for(let u=0;u<r;u++)u%2===0&&e.fillRect(l+c,m-r/2+u,d-l-c*2,1)}if(a<t-1){const d=(a+1)*n+n/2;for(let u=0;u<r;u++)u%2===0&&e.fillRect(l-r/2+u,m+c,1,d-m-c*2)}}}function ze(e,t,n,c){for(let r=0;r<t-1;r++)for(let i=0;i<t-1;i++){const a=(i+1)*n,s=(r+1)*n,l=o.numbers[r][i].toString(),m=R(l,4);C(e,l,a-m/2,s-14,4,c)}}function De(e,t,n,c,r){for(let i=0;i<t;i++)for(let a=0;a<t;a++){const s=a*n+n/2,l=i*n+n/2,m=o.animations.find(f=>f.x===a&&f.y===i);let d=1,u=0;m&&(d=1+Math.sin(m.progress*Math.PI)*.2,u=Math.sin(m.progress*Math.PI)*.6);const h=c*d;o.circles[i][a].filled?$e(e,s,l,h,r,u):Ge(e,s,l,h,r)}}function $e(e,t,n,c,r,i){e.fillStyle=r;for(let a=-c;a<=c;a++)if(Math.floor(n+a)%2===0){const s=Math.sqrt(c*c-a*a);e.fillRect(t-s,n+a,s*2,1)}if(i>0){const a=le(r);e.strokeStyle=`rgba(${a.r},${a.g},${a.b},${i})`,e.lineWidth=2,e.beginPath(),e.arc(t,n,c+8,0,Math.PI*2),e.stroke()}}function Ge(e,t,n,c,r){e.fillStyle=r;const i=4;for(let a=0;a<i;a++){const s=c-a;for(let l=0;l<Math.PI*2;l+=.03){const m=t+Math.cos(l)*s,d=n+Math.sin(l)*s;Math.floor(d)%2===0&&e.fillRect(Math.floor(m),Math.floor(d),2,1)}}}function ue(){const e=o.gridSize;o.circles=[],o.numbers=[];for(let t=0;t<e;t++){o.circles[t]=[];for(let n=0;n<e;n++)o.circles[t][n]={filled:!1,solution:Math.random()<.35}}for(let t=0;t<e-1;t++){o.numbers[t]=[];for(let n=0;n<e-1;n++){let c=0;o.circles[t][n].solution&&c++,o.circles[t][n+1].solution&&c++,o.circles[t+1][n].solution&&c++,o.circles[t+1][n+1].solution&&c++,o.numbers[t][n]=c}}}function Xe(){const e=o.gridSize;for(let t=0;t<e-1;t++)for(let n=0;n<e-1;n++){let c=0;if(o.circles[t][n].filled&&c++,o.circles[t][n+1].filled&&c++,o.circles[t+1][n].filled&&c++,o.circles[t+1][n+1].filled&&c++,c!==o.numbers[t][n])return!1}return!0}function Fe(e,t){return e>=0&&e<o.gridSize&&t>=0&&t<o.gridSize?(o.circles[t][e].filled=!o.circles[t][e].filled,He(e,t),!0):!1}function He(e,t){o.animations=o.animations.filter(n=>!(n.x===e&&n.y===t)),o.animations.push({x:e,y:t,progress:0})}function We(){return o.animations.length>0?(o.animations.forEach(e=>e.progress+=.08),o.animations=o.animations.filter(e=>e.progress<1),!0):!1}let p=null,B=null;function qe(){p=new Audio(I.musicTracks[0]),p.loop=!1,p.volume=I.defaultVolume,p.addEventListener("ended",()=>{o.currentTrack=(o.currentTrack+1)%I.musicTracks.length,p.src=I.musicTracks[o.currentTrack],p.play().catch(()=>{})}),B=new Audio(I.beepSound),B.volume=I.beepVolume}async function Ue(){if(!o.audioContext)try{o.audioContext=new(window.AudioContext||window.webkitAudioContext);const t=await(await fetch(I.beepSound)).arrayBuffer();o.beepBuffer=await o.audioContext.decodeAudioData(t)}catch(e){console.warn("Audio context init failed:",e)}}function O(){if(o.audioContext&&o.beepBuffer){const e=o.audioContext.createBufferSource(),t=o.audioContext.createGain();t.gain.value=I.beepVolume,e.buffer=o.beepBuffer,e.connect(t),t.connect(o.audioContext.destination),e.start(0)}else B&&(B.currentTime=0,B.play().catch(()=>{}))}function Ye(){o.musicStarted||!p||(p.volume=0,p.play().then(()=>{o.musicStarted=!0;const e=document.getElementById("equalizer");e&&!o.musicMuted&&e.classList.remove("paused");let t=0;const n=setInterval(()=>{t+=.02,t>=I.defaultVolume&&(t=I.defaultVolume,clearInterval(n)),o.musicMuted||(p.volume=t)},80)}).catch(()=>{}))}function me(){if(!p)return;p.pause(),p.currentTime=0,o.musicStarted=!1;const e=document.getElementById("equalizer");e&&e.classList.add("paused")}function Ve(){o.musicMuted=!o.musicMuted,p&&(p.muted=o.musicMuted);const e=document.getElementById("equalizer");e&&(o.musicMuted?e.classList.add("paused"):e.classList.remove("paused"))}function Ke(){p&&(o.currentTrack=(o.currentTrack+1)%I.musicTracks.length,p.src=I.musicTracks[o.currentTrack],p.play().catch(()=>{}))}function je(){return p}function Ze(){return B}async function Je(){try{const t=await(await fetch(se,{method:"GET",redirect:"follow"})).json();return o.leaderboardData.training=(t.training||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.challenge=(t.challenge||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.expert=(t.expert||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.training_chrono=(t.training_chrono||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.challenge_chrono=(t.challenge_chrono||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.expert_chrono=(t.expert_chrono||[]).sort((n,c)=>c.score-n.score),!0}catch(e){return console.error("Erreur fetch leaderboard:",e),!1}}async function fe(e,t){if(e<=0)return!1;try{const c={4:"training",5:"challenge",6:"expert"}[t]||"training",r=o.chronoEnabled?`${c}_chrono`:c,i=new URLSearchParams({action:"submit",nickname:o.nickname,score:e,mode:r}),a=`${se}?${i.toString()}`;return await fetch(a,{method:"GET",redirect:"follow"}),!0}catch(n){return console.error("Erreur submit score:",n),!1}}function Qe(){const t=["training","challenge","expert"][o.currentLeaderboardMode];return o.currentLeaderboardChrono?`${t}_chrono`:t}function et(){const e=Qe();return o.leaderboardData[e]||[]}function he(){if(Ne(o.starsEnabled,o.musicMuted),W(),Q(),o.chronoEnabled){const e=document.getElementById("timer-canvas");e&&(e.style.display="block"),q()}else{const e=document.getElementById("timer-canvas");e&&(e.style.display="none")}}function Q(){const e=document.getElementById("mode-canvas");if(!e)return;const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);const c=`${Re[o.gridSize].name}  ${Z(o.currentScore)} PTS`;g(t,c,e.width,10,3,w())}function q(){const e=document.getElementById("timer-canvas");if(!e)return;const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);let n=w();o.chronoRemaining<=10?n="#f55":o.chronoRemaining<=30&&(n="#fa5"),g(t,Be(o.chronoRemaining),e.width,8,4,n)}function G(e){o.gridSize=e,H(),ue(),v("game"),Ye(),o.chronoEnabled&&nt(),requestAnimationFrame(ge)}function ge(){const e=document.getElementById("game-screen");!e||!e.classList.contains("active")||(We()&&W(),requestAnimationFrame(ge))}function Ee(e){const t=document.getElementById("puzzle-canvas");if(!t)return;const n=t.getBoundingClientRect(),c=t.width/n.width,r=t.height/n.height,i=(e.clientX-n.left)*c,a=(e.clientY-n.top)*r,s=t.width/o.gridSize,l=Math.floor(i/s),m=Math.floor(a/s);Fe(l,m)&&(W(),Xe()&&tt())}function tt(){const e=o.gridSize*o.gridSize*100;o.currentScore+=e,o.puzzlesSolved++,o.chronoEnabled&&o.chronoActive&&(o.chronoRemaining+=F.bonus[o.gridSize]||10,q()),Q(),setTimeout(()=>{ue(),W()},500)}function nt(){o.chronoRemaining=F.startTime,o.chronoActive=!0,o.chronoInterval=setInterval(()=>{o.chronoRemaining--,q(),o.chronoRemaining<=0&&ot()},1e3)}function ee(){o.chronoInterval&&(clearInterval(o.chronoInterval),o.chronoInterval=null),o.chronoActive=!1}function ot(){ee(),o.currentScore>0&&fe(o.currentScore,o.gridSize),me(),v("gameover")}function pe(){ee(),o.currentScore>0&&fe(o.currentScore,o.gridSize),H(),j(),me(),v("menu")}const ct=Object.freeze(Object.defineProperty({__proto__:null,drawGameScreen:he,drawModeAndScore:Q,drawTimer:q,exitGame:pe,handlePuzzleClick:Ee,startGame:G,stopChrono:ee},Symbol.toStringTag,{value:"Module"}));function rt(){const e=w(),t=document.getElementById("howto-title");if(t){const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height),g(r,"HOW TO PLAY",t.width,10,4,e)}const n=document.getElementById("howto-content");if(n){const r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),["TAP CIRCLES TO","FILL THEM","","EACH NUMBER SHOWS","HOW MANY NEIGHBORS","ARE FILLED","","MATCH ALL NUMBERS","TO WIN"].forEach((a,s)=>{a&&g(r,a,n.width,5+s*34,3,e)})}const c=document.getElementById("howto-back");if(c){const r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),g(r,"BACK",c.width,10,3,e)}}function ye(){const e=w(),t=document.getElementById("nickname-title");if(t){const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height),g(r,"YOUR NICKNAME",t.width,10,4,e)}U();const n=document.getElementById("nickname-save");if(n){const r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),g(r,"SAVE",n.width,10,3,e)}const c=document.getElementById("nickname-back");if(c){const r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),g(r,"BACK",c.width,10,3,e)}}function U(){const e=document.getElementById("nickname-input-canvas");if(!e)return;const t=e.getContext("2d"),n=w();t.clearRect(0,0,e.width,e.height);const c=o.nicknameInput||"PLAYER";g(t,c,e.width,15,3,n),t.fillStyle=n;for(let r=20;r<e.width-20;r+=2)t.fillRect(r,45,1,2)}function be(){o.nicknameActive=!0,o.nicknameInput=o.nickname==="PLAYER"?"":o.nickname;const e=document.getElementById("hidden-input");e&&(e.value=o.nicknameInput,e.focus()),U()}function Y(){o.nicknameActive=!1;const e=document.getElementById("hidden-input");e&&e.blur()}function ve(e){o.nicknameInput=e.replace(/[^A-Za-z0-9]/g,"").toUpperCase().slice(0,10);const t=document.getElementById("hidden-input");t&&(t.value=o.nicknameInput),U()}function we(){Se(o.nicknameInput),Y()}const it=Object.freeze(Object.defineProperty({__proto__:null,drawNicknameInput:U,drawNicknameScreen:ye,handleNicknameInput:ve,saveCurrentNickname:we,startNicknameInput:be,stopNicknameInput:Y},Symbol.toStringTag,{value:"Module"})),at=["TRAINING 4X4","CHALLENGE 5X5","EXPERT 6X6"];function V(){const e=w(),t=document.getElementById("leaderboard-title");if(t){const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height),g(r,"LEADERBOARD",t.width,10,4,e)}J("lb-chrono-title",o.currentLeaderboardChrono===1),ie("lb-prev","left"),ie("lb-next","right");const n=document.getElementById("lb-mode-title");if(n){const r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),g(r,at[o.currentLeaderboardMode],n.width,5,3,e)}st();const c=document.getElementById("leaderboard-back");if(c){const r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),g(r,"BACK",c.width,10,3,e)}}function ie(e,t){const n=document.getElementById(e);if(!n)return;const c=n.getContext("2d");c.clearRect(0,0,n.width,n.height),g(c,t==="left"?"<":">",n.width,8,4,w())}async function st(){const e=document.getElementById("leaderboard-list");if(!e)return;const t=e.getContext("2d"),n=w();t.clearRect(0,0,e.width,e.height),g(t,"LOADING...",e.width,160,3,n),await Je(),t.clearRect(0,0,e.width,e.height);const c=et();if(c.length===0){g(t,"NO SCORES YET",e.width,160,3,n);return}const r=55,i=65,a=365;c.slice(0,10).forEach((s,l)=>{const m=10+l*34,d=`${l+1}.`,u=R(d,3);C(t,d,r-u,m,3,n);const h=10,f=s.nickname.length>h?s.nickname.substring(0,h):s.nickname;C(t,f,i,m,3,n);const y=Z(s.score),k=R(y,3);C(t,y,a-k,m,3,n)})}function lt(){o.currentLeaderboardMode=(o.currentLeaderboardMode+1)%3,V()}function dt(){o.currentLeaderboardMode=(o.currentLeaderboardMode-1+3)%3,V()}function ut(){o.currentLeaderboardChrono=(o.currentLeaderboardChrono+1)%2,V()}function mt(){const e=w(),t=document.getElementById("gameover-title");if(t){const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),g(i,"TIME UP",t.width,10,4,e)}const n=document.getElementById("gameover-score");if(n){const i=n.getContext("2d");i.clearRect(0,0,n.width,n.height),g(i,`${Z(o.currentScore)} PTS`,n.width,20,4,e),g(i,`${o.puzzlesSolved} PUZZLES`,n.width,70,3,e)}const c=document.getElementById("gameover-restart");if(c){const i=c.getContext("2d");i.clearRect(0,0,c.width,c.height),g(i,"RESTART",c.width,12,3,e)}const r=document.getElementById("gameover-menu");if(r){const i=r.getContext("2d");i.clearRect(0,0,r.width,r.height),g(i,"MENU",r.width,12,3,e)}}function ft(){const e=o.gridSize;H(),j(),K(async()=>{const{startGame:t}=await Promise.resolve().then(()=>ct);return{startGame:t}},void 0).then(({startGame:t})=>{t(e)})}function ht(){H(),j(),K(async()=>{const{showScreen:e}=await Promise.resolve().then(()=>gt);return{showScreen:e}},void 0).then(({showScreen:e})=>{e("menu")})}function v(e){document.querySelectorAll(".screen").forEach(n=>{n.classList.remove("active")});const t=document.getElementById(`${e}-screen`);switch(t&&t.classList.add("active"),e!=="nickname"&&Y(),e){case"menu":de();break;case"difficulty":Me();break;case"game":he();break;case"howto":rt();break;case"nickname":ye();break;case"leaderboard":V();break;case"gameover":mt();break}}const gt=Object.freeze(Object.defineProperty({__proto__:null,showScreen:v},Symbol.toStringTag,{value:"Module"})),Ie=[{stars:[],speed:.1,size:3,count:12,alpha:.2},{stars:[],speed:.25,size:4,count:10,alpha:.3},{stars:[],speed:.5,size:5,count:8,alpha:.45},{stars:[],speed:.9,size:7,count:5,alpha:.6},{stars:[],speed:1.4,size:9,count:3,alpha:.8}];let b=null,x=null;function Et(){b=document.getElementById("stars-canvas"),b&&(x=b.getContext("2d"),ae(),window.addEventListener("resize",ae),X())}function ae(){b&&(b.width=window.innerWidth,b.height=window.innerHeight,Ie.forEach(e=>{e.stars=[];for(let t=0;t<e.count;t++)e.stars.push({x:Math.random()*b.width,y:Math.random()*b.height})}))}function X(){if(!x||!b){requestAnimationFrame(X);return}if(x.fillStyle="#000",x.fillRect(0,0,b.width,b.height),!o.starsEnabled){requestAnimationFrame(X);return}const e=le(w()),t=b.width/2,n=b.height/2,c=Math.min(b.width,b.height)*.3,r=document.getElementById("game-screen"),i=r&&r.classList.contains("active");Ie.forEach(a=>{a.stars.forEach(s=>{let l=a.alpha;if(i){const m=s.x-t,d=s.y-n,u=Math.sqrt(m*m+d*d);u<c&&(l=a.alpha*(.15+u/c*.85))}x.fillStyle=`rgba(${e.r},${e.g},${e.b},${l})`,x.fillRect(Math.floor(s.x),Math.floor(s.y),a.size,a.size),s.y+=a.speed,s.y>b.height+a.size&&(s.y=-a.size*2,s.x=Math.random()*b.width)})}),requestAnimationFrame(X)}function pt(){qe(),Et(),yt(),bt()}function yt(){document.addEventListener("click",()=>Ue(),{once:!0}),document.addEventListener("click",e=>{(e.target.classList.contains("menu-item")||e.target.classList.contains("top-icon")||e.target.classList.contains("nav-arrow"))&&O()}),document.getElementById("menu-newgame")?.addEventListener("click",()=>v("difficulty")),document.getElementById("menu-leaderboard")?.addEventListener("click",()=>v("leaderboard")),document.getElementById("menu-nickname")?.addEventListener("click",()=>v("nickname")),document.getElementById("menu-howto")?.addEventListener("click",()=>v("howto")),document.getElementById("menu-color")?.addEventListener("click",()=>{o.currentTheme=(o.currentTheme+1)%ce.length,document.body.className=ce[o.currentTheme],de()}),document.getElementById("diff-training")?.addEventListener("click",()=>G(4)),document.getElementById("diff-challenge")?.addEventListener("click",()=>G(5)),document.getElementById("diff-expert")?.addEventListener("click",()=>G(6)),document.getElementById("diff-back")?.addEventListener("click",()=>v("menu")),document.getElementById("chrono-toggle")?.addEventListener("click",()=>{o.chronoEnabled=!o.chronoEnabled,J("chrono-toggle",o.chronoEnabled),O()}),document.getElementById("puzzle-canvas")?.addEventListener("click",Ee),document.getElementById("icon-home")?.addEventListener("click",pe),document.getElementById("icon-stars")?.addEventListener("click",()=>{o.starsEnabled=!o.starsEnabled,P("icon-stars","stars",o.starsEnabled)}),document.getElementById("icon-music")?.addEventListener("click",()=>{Ve(),P("icon-music","music",!o.musicMuted)}),document.getElementById("equalizer")?.addEventListener("click",Ke),document.getElementById("howto-back")?.addEventListener("click",()=>v("menu")),document.getElementById("nickname-input-canvas")?.addEventListener("click",be),document.getElementById("hidden-input")?.addEventListener("input",e=>{ve(e.target.value)}),document.getElementById("hidden-input")?.addEventListener("blur",()=>{o.nicknameActive&&K(()=>Promise.resolve().then(()=>it),void 0).then(e=>e.drawNicknameInput())}),document.getElementById("nickname-save")?.addEventListener("click",()=>{we(),v("menu")}),document.getElementById("nickname-back")?.addEventListener("click",()=>{Y(),v("menu")}),document.getElementById("lb-chrono-title")?.addEventListener("click",()=>{ut(),O()}),document.getElementById("lb-prev")?.addEventListener("click",()=>{dt(),O()}),document.getElementById("lb-next")?.addEventListener("click",()=>{lt(),O()}),document.getElementById("leaderboard-back")?.addEventListener("click",()=>v("menu")),document.getElementById("gameover-restart")?.addEventListener("click",ft),document.getElementById("gameover-menu")?.addEventListener("click",ht)}function bt(){const e=document.getElementById("preloader"),t=document.getElementById("preloader-canvas"),n=document.getElementById("game-container");if(!t||!e||!n){v("menu");return}const c=t.getContext("2d"),r=3;let i=0,a=!1,s=0,l=0;function m(){const M="#5c5",z=t.width,ke=t.height;c.clearRect(0,0,z,ke),g(c,"LOADING",z,15,4,M),g(c,`${Math.floor(s)}%`,z,55,3,M);const A=30,T=85,D=z-60,$=16;c.fillStyle=M;for(let E=0;E<2;E++)E%2===0&&c.fillRect(A,T+E,D,1);for(let E=0;E<2;E++)E%2===0&&c.fillRect(A,T+$-2+E,D,1);for(let E=0;E<2;E++)for(let L=0;L<$;L++)L%2===0&&c.fillRect(A+E,T+L,1,1);for(let E=0;E<2;E++)for(let L=0;L<$;L++)L%2===0&&c.fillRect(A+D-2+E,T+L,1,1);const te=Math.floor((D-8)*(s/100));if(te>0)for(let E=0;E<$-8;E++)E%2===0&&c.fillRect(A+4,T+4+E,te,1);s<l&&(s+=2,s>l&&(s=l)),a||requestAnimationFrame(m)}function d(){a||(i++,l=i/r*100,i>=r&&(l=100,setTimeout(u,500)))}function u(){a||(a=!0,e.style.transition="opacity 0.5s",e.style.opacity="0",setTimeout(()=>{e.style.display="none",n.style.display="flex",v("menu")},500))}m();const h=document.getElementById("logo-img");if(h){const M=h.src;h.src="",h.onload=d,h.onerror=d,h.src=M}else d();const f=je(),y=Ze();let k=!1,S=!1;function N(){k||(k=!0,d())}function _(){S||(S=!0,d())}f?(f.oncanplaythrough=N,f.onloadeddata=N,f.onerror=N):N(),y?(y.oncanplaythrough=_,y.onloadeddata=_,y.onerror=_):_(),setTimeout(()=>{a||(l=100,setTimeout(u,300))},5e3)}document.addEventListener("DOMContentLoaded",pt);
