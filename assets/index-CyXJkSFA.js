(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const fe="modulepreload",me=function(e){return"/musubi/"+e},q={},D=function(t,n,c){let r=Promise.resolve();if(n&&n.length>0){let d=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};var a=d;document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");r=d(n.map(u=>{if(u=me(u),u in q)return;q[u]=!0;const f=u.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":fe,f||(g.as="script"),g.crossOrigin="",g.href=u,l&&g.setAttribute("nonce",l),document.head.appendChild(g),f)return new Promise((v,C)=>{g.addEventListener("load",v),g.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return r.then(s=>{for(const l of s||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},U={A:["01110","10001","10001","11111","10001","10001","10001"],B:["11110","10001","10001","11110","10001","10001","11110"],C:["01110","10001","10000","10000","10000","10001","01110"],D:["11110","10001","10001","10001","10001","10001","11110"],E:["11111","10000","10000","11110","10000","10000","11111"],F:["11111","10000","10000","11110","10000","10000","10000"],G:["01110","10001","10000","10111","10001","10001","01110"],H:["10001","10001","10001","11111","10001","10001","10001"],I:["11111","00100","00100","00100","00100","00100","11111"],J:["00111","00010","00010","00010","00010","10010","01100"],K:["10001","10010","10100","11000","10100","10010","10001"],L:["10000","10000","10000","10000","10000","10000","11111"],M:["10001","11011","10101","10101","10001","10001","10001"],N:["10001","10001","11001","10101","10011","10001","10001"],O:["01110","10001","10001","10001","10001","10001","01110"],P:["11110","10001","10001","11110","10000","10000","10000"],Q:["01110","10001","10001","10001","10101","10010","01101"],R:["11110","10001","10001","11110","10100","10010","10001"],S:["01111","10000","10000","01110","00001","00001","11110"],T:["11111","00100","00100","00100","00100","00100","00100"],U:["10001","10001","10001","10001","10001","10001","01110"],V:["10001","10001","10001","10001","10001","01010","00100"],W:["10001","10001","10001","10101","10101","10101","01010"],X:["10001","10001","01010","00100","01010","10001","10001"],Y:["10001","10001","01010","00100","00100","00100","00100"],Z:["11111","00001","00010","00100","01000","10000","11111"],0:["01110","10001","10011","10101","11001","10001","01110"],1:["00100","01100","00100","00100","00100","00100","01110"],2:["01110","10001","00001","00010","00100","01000","11111"],3:["11111","00010","00100","00010","00001","10001","01110"],4:["00010","00110","01010","10010","11111","00010","00010"],5:["11111","10000","11110","00001","00001","10001","01110"],6:["00110","01000","10000","11110","10001","10001","01110"],7:["11111","00001","00010","00100","01000","01000","01000"],8:["01110","10001","10001","01110","10001","10001","01110"],9:["01110","10001","10001","01111","00001","00010","01100"]," ":["00000","00000","00000","00000","00000","00000","00000"],":":["00000","00100","00100","00000","00100","00100","00000"],"-":["00000","00000","00000","11111","00000","00000","00000"],".":["00000","00000","00000","00000","00000","01100","01100"],"<":["00010","00100","01000","10000","01000","00100","00010"],">":["01000","00100","00010","00001","00010","00100","01000"],_:["00000","00000","00000","00000","00000","00000","11111"]},Y=["","theme-cyan","theme-amber","theme-white","theme-pink"],A={startTime:60,bonus:{4:10,5:15,6:20}},he={4:{name:"Training",grid:"4X4"},5:{name:"Challenge",grid:"5X5"},6:{name:"Expert",grid:"6X6"}},Z="https://script.google.com/macros/s/AKfycbzwwGm8kGbcjixpMpR3xhfH4gofyMPY1kXnPdcGzl4tnrJz7ewgVDH2J825Lhh93940/exec",y={musicTracks:["/musubi/Music/Music1.mp3","/musubi/Music/Music2.mp3","/musubi/Music/Music3.mp3","/musubi/Music/Music4.mp3","/musubi/Music/Music5.mp3"],beepSound:"/musubi/Music/beepMenuChoice.mp3",defaultVolume:.5,beepVolume:.3},o={starsEnabled:!0,musicMuted:!1,currentTheme:0,gridSize:4,currentScore:0,puzzlesSolved:0,circles:[],numbers:[],animations:[],chronoEnabled:!1,chronoRemaining:A.startTime,chronoInterval:null,chronoActive:!1,nickname:localStorage.getItem("musubi_nickname")||"PLAYER",nicknameInput:"",nicknameActive:!1,currentLeaderboardMode:0,currentLeaderboardChrono:0,leaderboardData:{training:[],challenge:[],expert:[],training_chrono:[],challenge_chrono:[],expert_chrono:[]},currentTrack:0,musicStarted:!1,audioContext:null,beepBuffer:null};function T(){o.currentScore=0,o.puzzlesSolved=0,o.circles=[],o.numbers=[],o.animations=[]}function G(){o.chronoRemaining=A.startTime,o.chronoActive=!1,o.chronoInterval&&(clearInterval(o.chronoInterval),o.chronoInterval=null)}function ge(e){o.nickname=e||"PLAYER",localStorage.setItem("musubi_nickname",o.nickname)}function E(){return getComputedStyle(document.body).getPropertyValue("--color").trim()||"#5c5"}function pe(){return getComputedStyle(document.body).getPropertyValue("--color-bright").trim()||"#7f7"}function J(e){const t=/^#?([a-f\d]{1,2})([a-f\d]{1,2})([a-f\d]{1,2})$/i.exec(e);return t?{r:parseInt(t[1].length===1?t[1]+t[1]:t[1],16),g:parseInt(t[2].length===1?t[2]+t[2]:t[2],16),b:parseInt(t[3].length===1?t[3]+t[3]:t[3],16)}:{r:92,g:204,b:92}}function $(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function be(e){const t=Math.floor(e/60),n=e%60;return`${t}:${n<10?"0":""}${n}`}function I(e,t,n,c,r,i){const a=t.toUpperCase().split("");let s=0;return e.fillStyle=i,a.forEach(l=>{(U[l]||U[" "]).forEach((u,f)=>{for(let h=0;h<u.length;h++)if(u[h]==="1")for(let g=0;g<r;g++)g%2===0&&e.fillRect(n+s+h*r,c+f*r+g,r,1)}),s+=6*r}),s}function S(e,t){return e.length*6*t}function m(e,t,n,c,r,i){const a=S(t,r),s=(n-a)/2;I(e,t,s,c,r,i)}function V(e,t,n,c,r,i){e.fillStyle=i;for(let a=0;a<r;a++)a%2===0&&e.fillRect(t,n+a,c,1)}function Q(){const e=E();[{id:"menu-newgame",text:"NEW GAME"},{id:"menu-leaderboard",text:"LEADERBOARD"},{id:"menu-nickname",text:"YOUR NICKNAME"},{id:"menu-howto",text:"HOW TO PLAY"},{id:"menu-color",text:"COLOR"}].forEach(n=>{const c=document.getElementById(n.id);if(!c)return;const r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),m(r,n.text,c.width,12,3,e)})}function we(){const e=E(),t=document.getElementById("diff-title");if(t){const c=t.getContext("2d");c.clearRect(0,0,t.width,t.height),m(c,"SELECT MODE",t.width,10,4,e)}[{id:"diff-training",text:"TRAINING  4X4"},{id:"diff-challenge",text:"CHALLENGE  5X5"},{id:"diff-expert",text:"EXPERT  6X6"},{id:"diff-back",text:"BACK"}].forEach(c=>{const r=document.getElementById(c.id);if(!r)return;const i=r.getContext("2d");i.clearRect(0,0,r.width,r.height),m(i,c.text,r.width,12,3,e)}),X("chrono-toggle",o.chronoEnabled)}function X(e,t){const n=document.getElementById(e);if(!n)return;const c=n.getContext("2d"),r=E();c.clearRect(0,0,n.width,n.height);const i=3,a=S("OFF",i),s=S("ON",i),l=4,d=7*i,u=S("CHRONO",i),f=18,h=u+f+a+l*2+f+s+l*2,g=(n.width-h)/2,v=12;I(c,"CHRONO",g,v,i,r);const C=g+u+f,z=C+a+l*2+f;t?(I(c,"OFF",C,v,i,r),V(c,z-l,v-l,s+l*2,d+l*2,r),I(c,"ON",z,v,i,"#000")):(V(c,C-l,v-l,a+l*2,d+l*2,r),I(c,"OFF",C,v,i,"#000"),I(c,"ON",z,v,i,r))}function x(e,t,n=!0){const c=document.getElementById(e);if(!c)return;const r=c.getContext("2d"),i=n?E():"#333",a=c.width,s=c.height;switch(r.clearRect(0,0,a,s),r.fillStyle=i,t){case"stars":Ee(r);break;case"music":ve(r);break;case"home":ye(r);break}Ce(r,a,s)}function Ee(e){e.fillRect(23,5,4,4),e.fillRect(19,9,12,4),e.fillRect(11,13,28,4),e.fillRect(15,17,20,4),e.fillRect(19,21,12,4),e.fillRect(15,25,8,4),e.fillRect(27,25,8,4),e.fillRect(11,29,8,4),e.fillRect(31,29,8,4)}function ve(e){e.fillRect(28,6,4,24),e.fillRect(32,6,10,3),e.fillRect(32,11,8,3),e.fillRect(14,24,18,12)}function ye(e){e.fillRect(23,5,4,6),e.fillRect(15,11,20,4),e.fillRect(11,15,28,4),e.fillRect(14,19,22,16),e.fillStyle="#000",e.fillRect(21,25,8,10)}function Ce(e,t,n){const c=e.getImageData(0,0,t,n);for(let r=0;r<n;r++)if(r%2===1)for(let i=0;i<t;i++){const a=(r*t+i)*4;c.data[a+3]=Math.floor(c.data[a+3]*.3)}e.putImageData(c,0,0)}function Ie(e,t){x("icon-stars","stars",e),x("icon-music","music",!t),x("icon-home","home",!0)}function B(){const e=document.getElementById("puzzle-canvas");if(!e)return;const t=e.getContext("2d"),n=E(),c=pe(),r=o.gridSize,i=Math.min(500,window.innerWidth-40,window.innerHeight-250),a=Math.max(280,i);e.width=a,e.height=a;const s=a/r,l=s*.22,d=Math.max(4,Math.floor(a/100));t.clearRect(0,0,a,a),Se(t,r,s,l,d,n),ke(t,r,s,c),Re(t,r,s,l,n)}function Se(e,t,n,c,r,i){e.fillStyle=i;for(let a=0;a<t;a++)for(let s=0;s<t;s++){const l=s*n+n/2,d=a*n+n/2;if(s<t-1){const u=(s+1)*n+n/2;for(let f=0;f<r;f++)f%2===0&&e.fillRect(l+c,d-r/2+f,u-l-c*2,1)}if(a<t-1){const u=(a+1)*n+n/2;for(let f=0;f<r;f++)f%2===0&&e.fillRect(l-r/2+f,d+c,1,u-d-c*2)}}}function ke(e,t,n,c){for(let r=0;r<t-1;r++)for(let i=0;i<t-1;i++){const a=(i+1)*n,s=(r+1)*n,l=o.numbers[r][i].toString(),d=S(l,4);I(e,l,a-d/2,s-14,4,c)}}function Re(e,t,n,c,r){for(let i=0;i<t;i++)for(let a=0;a<t;a++){const s=a*n+n/2,l=i*n+n/2,d=o.animations.find(g=>g.x===a&&g.y===i);let u=1,f=0;d&&(u=1+Math.sin(d.progress*Math.PI)*.2,f=Math.sin(d.progress*Math.PI)*.6);const h=c*u;o.circles[i][a].filled?xe(e,s,l,h,r,f):Me(e,s,l,h,r)}}function xe(e,t,n,c,r,i){e.fillStyle=r;for(let a=-c;a<=c;a++)if(Math.floor(n+a)%2===0){const s=Math.sqrt(c*c-a*a);e.fillRect(t-s,n+a,s*2,1)}if(i>0){const a=J(r);e.strokeStyle=`rgba(${a.r},${a.g},${a.b},${i})`,e.lineWidth=2,e.beginPath(),e.arc(t,n,c+8,0,Math.PI*2),e.stroke()}}function Me(e,t,n,c,r){e.fillStyle=r;const i=4;for(let a=0;a<i;a++){const s=c-a;for(let l=0;l<Math.PI*2;l+=.03){const d=t+Math.cos(l)*s,u=n+Math.sin(l)*s;Math.floor(u)%2===0&&e.fillRect(Math.floor(d),Math.floor(u),2,1)}}}function ee(){const e=o.gridSize;do{o.circles=[],o.numbers=[];for(let t=0;t<e;t++){o.circles[t]=[];for(let n=0;n<e;n++)o.circles[t][n]={filled:!1,solution:Math.random()<.35}}for(let t=0;t<e-1;t++){o.numbers[t]=[];for(let n=0;n<e-1;n++){let c=0;o.circles[t][n].solution&&c++,o.circles[t][n+1].solution&&c++,o.circles[t+1][n].solution&&c++,o.circles[t+1][n+1].solution&&c++,o.numbers[t][n]=c}}}while(te())}function te(){const e=o.gridSize;for(let t=0;t<e-1;t++)for(let n=0;n<e-1;n++){let c=0;if(o.circles[t][n].filled&&c++,o.circles[t][n+1].filled&&c++,o.circles[t+1][n].filled&&c++,o.circles[t+1][n+1].filled&&c++,c!==o.numbers[t][n])return!1}return!0}function Le(e,t){return e>=0&&e<o.gridSize&&t>=0&&t<o.gridSize?(o.circles[t][e].filled=!o.circles[t][e].filled,Ae(e,t),!0):!1}function Ae(e,t){o.animations=o.animations.filter(n=>!(n.x===e&&n.y===t)),o.animations.push({x:e,y:t,progress:0})}function Te(){return o.animations.length>0?(o.animations.forEach(e=>e.progress+=.08),o.animations=o.animations.filter(e=>e.progress<1),!0):!1}let p=null,R=null;function Be(){p=new Audio(y.musicTracks[0]),p.loop=!1,p.volume=y.defaultVolume,p.addEventListener("ended",()=>{o.currentTrack=(o.currentTrack+1)%y.musicTracks.length,p.src=y.musicTracks[o.currentTrack],p.play().catch(()=>{})}),R=new Audio(y.beepSound),R.volume=y.beepVolume}async function Oe(){if(!o.audioContext)try{o.audioContext=new(window.AudioContext||window.webkitAudioContext);const t=await(await fetch(y.beepSound)).arrayBuffer();o.beepBuffer=await o.audioContext.decodeAudioData(t)}catch(e){console.warn("Audio context init failed:",e)}}function Ne(){if(o.audioContext&&o.beepBuffer){const e=o.audioContext.createBufferSource(),t=o.audioContext.createGain();t.gain.value=y.beepVolume,e.buffer=o.beepBuffer,e.connect(t),t.connect(o.audioContext.destination),e.start(0)}else R&&(R.currentTime=0,R.play().catch(()=>{}))}function Pe(){o.musicStarted||!p||(p.volume=0,p.play().then(()=>{o.musicStarted=!0;const e=document.getElementById("equalizer");e&&!o.musicMuted&&e.classList.remove("paused");let t=0;const n=setInterval(()=>{t+=.02,t>=y.defaultVolume&&(t=y.defaultVolume,clearInterval(n)),o.musicMuted||(p.volume=t)},80)}).catch(()=>{}))}function ne(){if(!p)return;p.pause(),p.currentTime=0,o.musicStarted=!1;const e=document.getElementById("equalizer");e&&e.classList.add("paused")}function _e(){o.musicMuted=!o.musicMuted,p&&(p.muted=o.musicMuted);const e=document.getElementById("equalizer");e&&(o.musicMuted?e.classList.add("paused"):e.classList.remove("paused"))}function ze(){p&&(o.currentTrack=(o.currentTrack+1)%y.musicTracks.length,p.src=y.musicTracks[o.currentTrack],p.play().catch(()=>{}))}function De(){return p}function Ge(){return R}async function $e(){try{const t=await(await fetch(Z,{method:"GET",redirect:"follow"})).json();return o.leaderboardData.training=(t.training||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.challenge=(t.challenge||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.expert=(t.expert||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.training_chrono=(t.training_chrono||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.challenge_chrono=(t.challenge_chrono||[]).sort((n,c)=>c.score-n.score),o.leaderboardData.expert_chrono=(t.expert_chrono||[]).sort((n,c)=>c.score-n.score),!0}catch(e){return console.error("Erreur fetch leaderboard:",e),!1}}async function H(e,t){if(e<=0)return!1;try{const c={4:"training",5:"challenge",6:"expert"}[t]||"training",r=o.chronoEnabled?`${c}_chrono`:c;console.log("Submit score:",{score:e,gridSize:t,chronoEnabled:o.chronoEnabled,finalMode:r,nickname:o.nickname});const i=new URLSearchParams({action:"submit",nickname:o.nickname,score:e,mode:r}),a=`${Z}?${i.toString()}`;console.log("URL:",a);const s=await fetch(a,{method:"GET",redirect:"follow"});return console.log("Response:",s.status),!0}catch(n){return console.error("Erreur submit score:",n),!1}}function Xe(){const t=["training","challenge","expert"][o.currentLeaderboardMode];return o.currentLeaderboardChrono?`${t}_chrono`:t}function He(){const e=Xe();return o.leaderboardData[e]||[]}function oe(){if(Ie(o.starsEnabled,o.musicMuted),B(),F(),o.chronoEnabled){const e=document.getElementById("timer-canvas");e&&(e.style.display="block"),O()}else{const e=document.getElementById("timer-canvas");e&&(e.style.display="none")}}function F(){const e=document.getElementById("mode-canvas");if(!e)return;const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);const c=`${he[o.gridSize].name}  ${$(o.currentScore)} PTS`,r=c.length>20?2:3;m(t,c,e.width,10,r,E())}function O(){const e=document.getElementById("timer-canvas");if(!e)return;const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);let n=E();o.chronoRemaining<=10?n="#f55":o.chronoRemaining<=30&&(n="#fa5"),m(t,be(o.chronoRemaining),e.width,8,4,n)}function M(e){o.gridSize=e,T(),ee(),w("game"),Pe(),o.chronoEnabled&&We(),requestAnimationFrame(ce)}function ce(){const e=document.getElementById("game-screen");!e||!e.classList.contains("active")||(Te()&&B(),requestAnimationFrame(ce))}function re(e){const t=document.getElementById("puzzle-canvas");if(!t)return;const n=t.getBoundingClientRect(),c=t.width/n.width,r=t.height/n.height,i=(e.clientX-n.left)*c,a=(e.clientY-n.top)*r,s=t.width/o.gridSize,l=Math.floor(i/s),d=Math.floor(a/s);Le(l,d)&&(B(),te()&&Fe())}function Fe(){const e=o.gridSize*o.gridSize*100;o.currentScore+=e,o.puzzlesSolved++,o.chronoEnabled&&o.chronoActive&&(o.chronoRemaining+=A.bonus[o.gridSize]||10,O()),F(),setTimeout(()=>{ee(),B()},500)}function We(){o.chronoRemaining=A.startTime,o.chronoActive=!0,o.chronoInterval=setInterval(()=>{o.chronoRemaining--,O(),o.chronoRemaining<=0&&qe()},1e3)}function W(){o.chronoInterval&&(clearInterval(o.chronoInterval),o.chronoInterval=null),o.chronoActive=!1}function qe(){W(),o.currentScore>0&&H(o.currentScore,o.gridSize),ne(),w("gameover")}function ie(){W(),o.currentScore>0&&H(o.currentScore,o.gridSize),T(),G(),ne(),w("menu")}const Ue=Object.freeze(Object.defineProperty({__proto__:null,drawGameScreen:oe,drawModeAndScore:F,drawTimer:O,exitGame:ie,handlePuzzleClick:re,startGame:M,stopChrono:W},Symbol.toStringTag,{value:"Module"}));function Ye(){const e=E(),t=document.getElementById("howto-title");if(t){const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height),m(r,"HOW TO PLAY",t.width,10,4,e)}const n=document.getElementById("howto-content");if(n){const r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),["TAP CIRCLES TO","FILL THEM","","EACH NUMBER SHOWS","HOW MANY NEIGHBORS","ARE FILLED","","MATCH ALL NUMBERS","TO WIN"].forEach((a,s)=>{a&&m(r,a,n.width,5+s*34,3,e)})}const c=document.getElementById("howto-back");if(c){const r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),m(r,"BACK",c.width,10,3,e)}}function ae(){const e=E();o.nicknameInput=o.nickname,o.nicknameActive=!1;const t=document.getElementById("nickname-title");if(t){const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height),m(r,"YOUR NICKNAME",t.width,10,4,e)}N();const n=document.getElementById("nickname-save");if(n){const r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),m(r,"SAVE",n.width,10,3,e)}const c=document.getElementById("nickname-back");if(c){const r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),m(r,"BACK",c.width,10,3,e)}}function N(){const e=document.getElementById("nickname-input-canvas");if(!e)return;const t=e.getContext("2d"),n=E();t.clearRect(0,0,e.width,e.height);let c;o.nicknameActive?c=o.nicknameInput:c=o.nickname||"PLAYER",m(t,c,e.width,15,3,n),t.fillStyle=n;for(let r=20;r<e.width-20;r+=2)t.fillRect(r,45,1,2)}function se(){o.nicknameActive=!0,o.nicknameInput="";const e=document.getElementById("hidden-input");e&&(e.value="",e.focus()),N()}function P(){o.nicknameActive=!1;const e=document.getElementById("hidden-input");e&&e.blur()}function le(e){o.nicknameInput=e.replace(/[^A-Za-z0-9]/g,"").toUpperCase().slice(0,10);const t=document.getElementById("hidden-input");t&&(t.value=o.nicknameInput),N()}function de(){const e=o.nicknameInput||"PLAYER";ge(e),P(),Ve()}function Ve(){const e=document.getElementById("nickname-save");if(!e)return;const t=e.getContext("2d"),n=E();t.clearRect(0,0,e.width,e.height),m(t,"DONE",e.width,10,3,n),setTimeout(()=>{t.clearRect(0,0,e.width,e.height),m(t,"SAVE",e.width,10,3,n)},1500)}const Ke=Object.freeze(Object.defineProperty({__proto__:null,drawNicknameInput:N,drawNicknameScreen:ae,handleNicknameInput:le,saveCurrentNickname:de,startNicknameInput:se,stopNicknameInput:P},Symbol.toStringTag,{value:"Module"})),je=["TRAINING 4X4","CHALLENGE 5X5","EXPERT 6X6"];function _(){const e=E(),t=document.getElementById("leaderboard-title");if(t){const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height),m(r,"LEADERBOARD",t.width,10,4,e)}X("lb-chrono-title",o.currentLeaderboardChrono===1),K("lb-prev","left"),K("lb-next","right");const n=document.getElementById("lb-mode-title");if(n){const r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),m(r,je[o.currentLeaderboardMode],n.width,5,3,e)}Ze();const c=document.getElementById("leaderboard-back");if(c){const r=c.getContext("2d");r.clearRect(0,0,c.width,c.height),m(r,"BACK",c.width,10,3,e)}}function K(e,t){const n=document.getElementById(e);if(!n)return;const c=n.getContext("2d");c.clearRect(0,0,n.width,n.height),m(c,t==="left"?"<":">",n.width,8,4,E())}async function Ze(){const e=document.getElementById("leaderboard-list");if(!e)return;const t=e.getContext("2d"),n=E();t.clearRect(0,0,e.width,e.height),m(t,"LOADING...",e.width,160,3,n),await $e(),t.clearRect(0,0,e.width,e.height);const c=He();if(c.length===0){m(t,"NO SCORES YET",e.width,160,3,n);return}const r=55,i=65,a=365;c.slice(0,10).forEach((s,l)=>{const d=10+l*34,u=`${l+1}.`,f=S(u,3);I(t,u,r-f,d,3,n);const h=10,g=s.nickname.length>h?s.nickname.substring(0,h):s.nickname;I(t,g,i,d,3,n);const v=$(s.score),C=S(v,3);I(t,v,a-C,d,3,n)})}function Je(){o.currentLeaderboardMode=(o.currentLeaderboardMode+1)%3,_()}function Qe(){o.currentLeaderboardMode=(o.currentLeaderboardMode-1+3)%3,_()}function et(){o.currentLeaderboardChrono=(o.currentLeaderboardChrono+1)%2,_()}function tt(){const e=E(),t=document.getElementById("gameover-title");if(t){const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),m(i,"TIME UP",t.width,10,4,e)}const n=document.getElementById("gameover-score");if(n){const i=n.getContext("2d");i.clearRect(0,0,n.width,n.height),m(i,`${$(o.currentScore)} PTS`,n.width,20,4,e),m(i,`${o.puzzlesSolved} PUZZLES`,n.width,70,3,e)}const c=document.getElementById("gameover-restart");if(c){const i=c.getContext("2d");i.clearRect(0,0,c.width,c.height),m(i,"RESTART",c.width,12,3,e)}const r=document.getElementById("gameover-menu");if(r){const i=r.getContext("2d");i.clearRect(0,0,r.width,r.height),m(i,"MENU",r.width,12,3,e)}o.currentScore>0&&H(o.currentScore,o.gridSize)}function nt(){const e=o.gridSize;T(),G(),D(async()=>{const{startGame:t}=await Promise.resolve().then(()=>Ue);return{startGame:t}},void 0).then(({startGame:t})=>{t(e)})}function ot(){T(),G(),D(async()=>{const{showScreen:e}=await Promise.resolve().then(()=>ct);return{showScreen:e}},void 0).then(({showScreen:e})=>{e("menu")})}function w(e){document.querySelectorAll(".screen").forEach(n=>{n.classList.remove("active")});const t=document.getElementById(`${e}-screen`);switch(t&&t.classList.add("active"),e!=="nickname"&&P(),e){case"menu":Q();break;case"difficulty":we();break;case"game":oe();break;case"howto":Ye();break;case"nickname":ae();break;case"leaderboard":_();break;case"gameover":tt();break}}const ct=Object.freeze(Object.defineProperty({__proto__:null,showScreen:w},Symbol.toStringTag,{value:"Module"})),ue=[{stars:[],speed:.1,size:3,count:12,alpha:.2},{stars:[],speed:.25,size:4,count:10,alpha:.3},{stars:[],speed:.5,size:5,count:8,alpha:.45},{stars:[],speed:.9,size:7,count:5,alpha:.6},{stars:[],speed:1.4,size:9,count:3,alpha:.8}];let b=null,k=null;function rt(){b=document.getElementById("stars-canvas"),b&&(k=b.getContext("2d"),j(),window.addEventListener("resize",j),L())}function j(){b&&(b.width=window.innerWidth,b.height=window.innerHeight,ue.forEach(e=>{e.stars=[];for(let t=0;t<e.count;t++)e.stars.push({x:Math.random()*b.width,y:Math.random()*b.height})}))}function L(){if(!k||!b){requestAnimationFrame(L);return}if(k.fillStyle="#000",k.fillRect(0,0,b.width,b.height),!o.starsEnabled){requestAnimationFrame(L);return}const e=J(E()),t=b.width/2,n=b.height/2,c=Math.min(b.width,b.height)*.3,r=document.getElementById("game-screen"),i=r&&r.classList.contains("active");ue.forEach(a=>{a.stars.forEach(s=>{let l=a.alpha;if(i){const d=s.x-t,u=s.y-n,f=Math.sqrt(d*d+u*u);f<c&&(l=a.alpha*(.15+f/c*.85))}k.fillStyle=`rgba(${e.r},${e.g},${e.b},${l})`,k.fillRect(Math.floor(s.x),Math.floor(s.y),a.size,a.size),s.y+=a.speed,s.y>b.height+a.size&&(s.y=-a.size*2,s.x=Math.random()*b.width)})}),requestAnimationFrame(L)}function it(){Be(),rt(),at(),st()}function at(){document.addEventListener("click",Oe,{once:!0}),document.addEventListener("click",t=>{const n=t.target.id,c=t.target.classList;(c.contains("menu-item")||c.contains("top-icon")||c.contains("nav-arrow"))&&Ne(),n==="menu-newgame"&&(o.nickname==="PLAYER"?w("nickname"):w("difficulty")),n==="menu-leaderboard"&&w("leaderboard"),n==="menu-nickname"&&w("nickname"),n==="menu-howto"&&w("howto"),n==="menu-color"&&(o.currentTheme=(o.currentTheme+1)%Y.length,document.body.className=Y[o.currentTheme],Q()),n==="diff-training"&&M(4),n==="diff-challenge"&&M(5),n==="diff-expert"&&M(6),n==="diff-back"&&w("menu"),n==="chrono-toggle"&&(o.chronoEnabled=!o.chronoEnabled,X("chrono-toggle",o.chronoEnabled)),n==="icon-home"&&ie(),n==="icon-stars"&&(o.starsEnabled=!o.starsEnabled,x("icon-stars","stars",o.starsEnabled)),n==="icon-music"&&(_e(),x("icon-music","music",!o.musicMuted)),n==="equalizer"&&ze(),n==="howto-back"&&w("menu"),n==="nickname-input-canvas"&&se(),n==="nickname-save"&&(de(),setTimeout(()=>w("menu"),1500)),n==="nickname-back"&&(P(),w("menu")),n==="lb-chrono-title"&&et(),n==="lb-prev"&&Qe(),n==="lb-next"&&Je(),n==="leaderboard-back"&&w("menu"),n==="gameover-restart"&&nt(),n==="gameover-menu"&&ot()}),document.addEventListener("click",t=>{t.target.id==="puzzle-canvas"&&re(t)});const e=document.getElementById("hidden-input");e&&(e.addEventListener("input",t=>{le(t.target.value)}),e.addEventListener("blur",()=>{o.nicknameActive&&D(()=>Promise.resolve().then(()=>Ke),void 0).then(t=>t.drawNicknameInput())}))}function st(){const e=document.getElementById("preloader"),t=document.getElementById("preloader-canvas"),n=document.getElementById("game-container");if(!e||!t||!n){w("menu");return}const c=t.getContext("2d"),r=3;let i=0,a=0,s=0,l=!1;function d(){l||(i++,s=i/r*100,i>=r&&(s=100,setTimeout(u,500)))}function u(){l||(l=!0,e.style.opacity="0",setTimeout(()=>{e.style.display="none",n.style.display="flex",w("menu")},500))}function f(){c.clearRect(0,0,t.width,t.height),m(c,"LOADING",t.width,15,4,"#5c5"),m(c,`${Math.floor(a)}%`,t.width,55,3,"#5c5"),a<s&&(a+=2),l||requestAnimationFrame(f)}f();const h=document.getElementById("logo-img");if(h){const C=h.src;h.src="",h.onload=d,h.onerror=d,h.src=C}else d();const g=De(),v=Ge();g?g.oncanplaythrough=d:d(),v?v.oncanplaythrough=d:d(),setTimeout(()=>!l&&u(),5e3)}document.addEventListener("DOMContentLoaded",it);
